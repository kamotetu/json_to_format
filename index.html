<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>json to format</title>
    </head>
    <body>
        <main>
            <style>
                body {
                    /* margin: 0 0 !important; */
                }
                .string {
                    color: #ce9178; 
                }
                .number {
                    color: #b5cea8;
                }
                .boolean {
                    color: #569cd6;
                }
                .null {
                    color: #9cdcfe;
                }
                .key {
                    color: #dcdcaa;
                }
                .head_area {
                    position: sticky;
                    top: 0;
                    background-color: white;
                    padding-bottom: 30px;
                }
                .title_area {
                    margin-bottom: 10px;
                }
                .input_area {
                    display: flex;
                    gap: 20px;
                }
                #output {
                    margin: 0 0 !important;
                }
            </style>
            <div class="head_area">
                <header>JSON TO FORMAT</header>
                <div class="title_area" style="margin-top: 10px;">
                    <label for="title"></label>
                    <textarea name="" id="title" placeholder="メモ欄"></textarea>
                </div>
                <div class="input_area">
                    <div class="js-textarea_area">
                        <label for="json_data"></label>
                        <textarea style="height: 100%;" id="json_data" name="json_data" placeholder='{"name": "Taro"}'></textarea>
                        <button type="button" class="js-submit">send</button>
                    </div>
                    <div class="js-file_upload_area">
                        <label
                            for="jsonFileInput"
                            style="display: block; cursor: pointer; background-color: #f0f0f0; padding: 10px; border-radius: 5px;"
                            class="js-file_upload"
                        >
                            <span class="js-file_upload_text">ファイルアップロード</span>
                            <span class="js-file_upload_sub_text" style="display: block; font-size: 0.8em; color: #666;">JSONファイルを選択してください</span>
                            <input style="display: none;" type="file" name="json_file" accept=".json" id="jsonFileInput">
                        </label>
                        
                    </div>
                    <div style="display: flex;">
                        <div class="button_wrapper">
                            <button
                                type="button"
                                class="js-copy"
                                style="height: 100%;"
                            >copy</button>
                        </div>
                        <div class="button_wrapper" style="margin-left: 10px;">
                            <button
                                type="button"
                                class="js-clear"
                                style="height: 100%;"
                            >clear</button>
                        </div>
                    </div>
                    <div class="js-copy_message_area">

                    </div>
                </div>
            </div>

            <pre id="output" style="background:#1e1e1e; color:#dcdcdc; padding:10px; border-radius:8px;"></pre>
            <script>
                function toFormat (json_data) {
                    json_data = json_data.replace(/[\r\n\t]/g, '');
                    return JSON.parse(json_data);
                }
                document.querySelector('.js-submit').addEventListener('click', function() {
                    let jsonData = document.querySelector('textarea[name="json_data"]').value;
                    try {
                        const parsedData = toFormat(jsonData);
                        document.getElementById("output").innerHTML = syntaxHighlight(parsedData);
                    } catch (e) {
                        document.getElementById("output").textContent = 'Invalid JSON: ' + e.message;
                    }
                });
                document.querySelector('.js-clear').addEventListener('click', function() {
                    document.querySelector('textarea[name="json_data"]').value = '';
                    document.getElementById("output").textContent = '';
                    document.querySelector('#jsonFileInput').value = '';
                    document.querySelector('.js-file_upload_sub_text').textContent = 'JSONファイルを選択してください';
                });
                function syntaxHighlight(json) {
                    json = JSON.stringify(json, null, 2);
                    return json
                        .replace(/(&)/g, "&amp;")
                        .replace(/(>)/g, "&gt;")
                        .replace(/(<)/g, "&lt;")
                        .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,
                            match => {
                                let cls = 'number';
                                if (/^"/.test(match)) {
                                cls = /:$/.test(match) ? 'key' : 'string';
                                } else if (/true|false/.test(match)) {
                                cls = 'boolean';
                                } else if (/null/.test(match)) {
                                cls = 'null';
                                }
                                return `<span class="${cls}">${match}</span>`;
                        });
                }

                document.querySelector('#jsonFileInput').addEventListener('change', function(e) {
                    const fileInput = e.target;
                    if (fileInput.files.length === 0) {
                        alert('Please select a JSON file to upload.');
                        return;
                    }
                    const file = fileInput.files[0];
                    loadFile(file);
                });

                function loadFile (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        try {
                            const jsonData = event.target.result;
                            const parsedData = toFormat(jsonData);
                            document.getElementById("output").innerHTML = syntaxHighlight(parsedData);
                            document.querySelector('.js-file_upload_text').textContent = 'ファイルアップロード';
                            document.querySelector('.js-file_upload_sub_text').textContent = file.name;
                        } catch (e) {
                            document.getElementById("output").textContent = 'Invalid JSON: ' + e.message;
                            document.querySelector('.js-file_upload_sub_text').textContent = 'JSONファイルを選択してください';
                        }
                    };
                    reader.readAsText(file);
                }

                document.querySelector('.js-copy').addEventListener('click', function() {
                    const output = document.getElementById("output");
                    if (output.textContent) {
                        navigator.clipboard.writeText(output.textContent).then(() => {
                            document.querySelector('.js-copy_message_area').textContent = 'Copied to clipboard!';
                            setTimeout(() => {
                                document.querySelector('.js-copy_message_area').textContent = '';
                            }, 2000);
                        }, () => {
                            document.querySelector('.js-copy_message_area').textContent = 'Failed to copy text.';
                            setTimeout(() => {
                                document.querySelector('.js-copy_message_area').textContent = '';
                            }, 2000);
                        });
                    } else {
                        document.querySelector('.js-copy_message_area').textContent = 'Nothing to copy.';
                            setTimeout(() => {
                                document.querySelector('.js-copy_message_area').textContent = '';
                            }, 2000);
                    }
                });

                document.querySelector('.js-file_upload').addEventListener('dragover', function (e) {
                    e.preventDefault();
                    if (e.dataTransfer.types[0] === 'Files') {
                        document.querySelector('.js-file_upload_text').textContent = 'ドロップ！';
                    }
                });
                document.querySelector('.js-file_upload').addEventListener('drop', function (e) {
                    e.preventDefault();
                    if (e.dataTransfer.types[0] === 'Files') {
                        const file = e.dataTransfer.files[0];
                        loadFile(file);
                    }
                });
            </script>
        </main>
    </body>
</html>
